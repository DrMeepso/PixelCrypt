var F=Object.defineProperty;var T=(n,e,r)=>e in n?F(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r;var m=(n,e,r)=>(T(n,typeof e!="symbol"?e+"":e,r),r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))l(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function r(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(t){if(t.ep)return;t.ep=!0;const i=r(t);fetch(t.href,i)}})();class E{constructor(e,r,l){m(this,"x");m(this,"y");m(this,"z");this.x=e,this.y=r,this.z=l}}function S(){let n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=.",e=new E(4,4,5),r=[];for(let l=0;l<e.x;l++)for(let t=0;t<e.y;t++)for(let i=0;i<e.z;i++)r.push({position:new E(l,t,i),value:n.charAt(i+t*e.z+l*e.z*e.y)});return r}class B{constructor(e,r,l,t){m(this,"r",0);m(this,"g",0);m(this,"b",0);m(this,"a",0);this.r=e,this.g=r,this.b=l,this.a=t}}function L(n){let e=[];for(let r=0;r<n.length;r+=4)e.push(new B(n[r],n[r+1],n[r+2],n[r+3]));return e}const P=S();function O(n,e){return new Promise((r,l)=>{var t=new Image;t.src=n,t.onload=function(){let d=document.getElementById("Render");d.width=t.width,d.height=t.height;let y=d.getContext("2d");y.imageSmoothingEnabled=!1,y.drawImage(t,0,0),i()};const i=()=>{var w;let d=t.width*t.height;console.log(Math.floor(d/9)+" chars max!"),console.log(e.length+" chars to encode!");let y=Math.floor(t.width/3),z=Math.floor(t.height/3),v=document.getElementById("Render"),u=v.getContext("2d",{willReadFrequently:!0}),I=btoa(e)+".";if(I.length>Math.floor(d/9)){console.error("Text is too long!"),l("Text is too long!");return}for(let g=0;g<y;g++)for(let f=0;f<z;f++){let o=new B(0,0,0,0),M=f*y+g;if(M>I.length)continue;let s=u.getImageData(g*3,f*3,3,3).data,c=L(s);for(let h=0;h<c.length;h++)h!=4&&(o.r+=c[h].r,o.g+=c[h].g,o.b+=c[h].b);let b=I.charAt(M),a=(w=P.find(h=>h.value==b))==null?void 0:w.position;if(a==null){console.error("Char not found in matrix!");continue}o.r=(Math.floor(o.r/8)>4?Math.floor(o.r/8)-4:0)+(a==null?void 0:a.x),o.g=(Math.floor(o.g/8)>4?Math.floor(o.g/8)-4:0)+(a==null?void 0:a.y),o.b=(Math.floor(o.b/8)>5?Math.floor(o.b/8)-5:0)+(a==null?void 0:a.z),o.a=c[4].a,o.a<255&&l("Image has to be opaque!"),u.fillStyle="rgba("+o.r+","+o.g+","+o.b+","+o.a+")",u.fillRect(g*3+1,f*3+1,1,1)}console.log("done! encode!"),console.log(e),r(v.toDataURL())}})}function N(n){return new Promise((e,r)=>{var l=new Image;l.src=n,l.onload=function(){let i=document.getElementById("Render");i.width=l.width,i.height=l.height;let d=i.getContext("2d");return d.imageSmoothingEnabled=!1,d.drawImage(l,0,0),t()};const t=()=>{var w;let i=l.width*l.height;console.log(Math.floor(i/9)+" chars max! Decode");let d=Math.floor(l.width/3),y=Math.floor(l.height/3),v=document.getElementById("Render").getContext("2d",{willReadFrequently:!0}),u=!1,I="";for(let g=0;g<y;g++)for(let f=0;f<d;f++){if(u)continue;let o=new B(0,0,0,0),M=v.getImageData(f*3,g*3,3,3).data,s=L(M);for(let a=0;a<s.length;a++)a!=4&&(o.r+=s[a].r,o.g+=s[a].g,o.b+=s[a].b);o.r=Math.floor(o.r/8)>4?Math.floor(o.r/8)-4:0,o.g=Math.floor(o.g/8)>4?Math.floor(o.g/8)-4:0,o.b=Math.floor(o.b/8)>5?Math.floor(o.b/8)-5:0,o.a=s[4].a;let c=new E(0,0,0);c.x=s[4].r-o.r,c.y=s[4].g-o.g,c.z=s[4].b-o.b;let b=(w=P.find(a=>a.position.x==c.x&&a.position.y==c.y&&a.position.z==c.z))==null?void 0:w.value;b!="."&&(I+=b),b=="."&&(u=!0),u&&console.log(atob(I))}console.log("done! decode!"),e(atob(I)),u==!1&&console.warn("Image is not encoded!")}})}setTimeout(()=>{document.getElementById("Render")},500);let p=document.getElementById("FileInputPicker"),k=document.getElementById("FilePickerButton"),D=document.getElementById("FilePickerLabel"),A=document.getElementById("EncodeButton"),q=document.getElementById("DecodeButton"),R=document.getElementById("PreviewImage");var x="";k.addEventListener("click",()=>{p.click()});p.addEventListener("change",()=>{if(p==null||p.files==null)return;let n=p.files[0],e=new FileReader;e.onload=r=>{R.src=e.result,x=e.result,D.innerText=n.name},e.readAsDataURL(n)});document.ondragover=n=>{n.preventDefault()};document.ondrop=n=>{var l;n.preventDefault();let e=(l=n.dataTransfer)==null?void 0:l.files[0],r=new FileReader;r.onload=t=>{R.src=r.result,x=r.result,D.innerText=e.name},r.readAsDataURL(e)};let C=document.getElementById("EncodeText");A.addEventListener("click",()=>{O(x,C==null?void 0:C.value).then(n=>{R.src=n,alert(`Done!
Image on the left is now encoded with your text!
Right click to save it`),x=n})});q.addEventListener("click",()=>{N(x).then(n=>{let e=document.getElementById("DecodedText");e.value=n,x=n})});
