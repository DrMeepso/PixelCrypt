var O=Object.defineProperty;var P=(n,e,r)=>e in n?O(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r;var f=(n,e,r)=>(P(n,typeof e!="symbol"?e+"":e,r),r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const l of t)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function r(t){const l={};return t.integrity&&(l.integrity=t.integrity),t.referrerPolicy&&(l.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?l.credentials="include":t.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(t){if(t.ep)return;t.ep=!0;const l=r(t);fetch(t.href,l)}})();class C{constructor(e,r,i){f(this,"x");f(this,"y");f(this,"z");this.x=e,this.y=r,this.z=i}}function N(){let n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=.",e=new C(4,4,5),r=[];for(let i=0;i<e.x;i++)for(let t=0;t<e.y;t++)for(let l=0;l<e.z;l++)r.push({position:new C(i,t,l),value:n.charAt(l+t*e.z+i*e.z*e.y)});return r}class B{constructor(e,r,i,t){f(this,"r",0);f(this,"g",0);f(this,"b",0);f(this,"a",0);this.r=e,this.g=r,this.b=i,this.a=t}}function D(n){let e=[];for(let r=0;r<n.length;r+=4)e.push(new B(n[r],n[r+1],n[r+2],n[r+3]));return e}const F=N();function T(n,e){return new Promise((r,i)=>{var t=new Image;t.src=n,t.onload=function(){let d=document.getElementById("Render");d.width=t.width,d.height=t.height;let m=d.getContext("2d");m.imageSmoothingEnabled=!1,m.drawImage(t,0,0),l()};const l=()=>{var w;let d=t.width*t.height;console.log(Math.floor(d/9)+" chars max!"),console.log(e.length+" chars to encode!");let m=Math.floor(t.width/3),z=Math.floor(t.height/3),v=document.getElementById("Render"),I=v.getContext("2d",{willReadFrequently:!0}),y=btoa(e)+".";if(y.length>Math.floor(d/9)){console.error("Text is too long!");return}for(let g=0;g<m;g++)for(let h=0;h<z;h++){let o=new B(0,0,0,0),b=h*m+g;if(b>y.length)continue;let s=I.getImageData(g*3,h*3,3,3).data,c=D(s);for(let u=0;u<c.length;u++)u!=4&&(o.r+=c[u].r,o.g+=c[u].g,o.b+=c[u].b);let x=y.charAt(b),a=(w=F.find(u=>u.value==x))==null?void 0:w.position;if(a==null){console.error("Char not found in matrix!");continue}o.r=(Math.floor(o.r/8)>4?Math.floor(o.r/8)-4:0)+(a==null?void 0:a.x),o.g=(Math.floor(o.g/8)>4?Math.floor(o.g/8)-4:0)+(a==null?void 0:a.y),o.b=(Math.floor(o.b/8)>5?Math.floor(o.b/8)-5:0)+(a==null?void 0:a.z),o.a=c[4].a,I.fillStyle="rgba("+o.r+","+o.g+","+o.b+","+o.a+")",I.fillRect(g*3+1,h*3+1,1,1)}console.log("done! encode!"),console.log(e),r(v.toDataURL())}})}function A(n){return new Promise((e,r)=>{var i=new Image;i.src=n,i.onload=function(){let l=document.getElementById("Render");l.width=i.width,l.height=i.height;let d=l.getContext("2d");return d.imageSmoothingEnabled=!1,d.drawImage(i,0,0),t()};const t=()=>{var w;let l=i.width*i.height;console.log(Math.floor(l/9)+" chars max! Decode");let d=Math.floor(i.width/3),m=Math.floor(i.height/3),v=document.getElementById("Render").getContext("2d",{willReadFrequently:!0}),I=!1,y="";for(let g=0;g<m;g++)for(let h=0;h<d;h++){if(I)continue;let o=new B(0,0,0,0),b=v.getImageData(h*3,g*3,3,3).data,s=D(b);for(let a=0;a<s.length;a++)a!=4&&(o.r+=s[a].r,o.g+=s[a].g,o.b+=s[a].b);o.r=Math.floor(o.r/8)>4?Math.floor(o.r/8)-4:0,o.g=Math.floor(o.g/8)>4?Math.floor(o.g/8)-4:0,o.b=Math.floor(o.b/8)>5?Math.floor(o.b/8)-5:0,o.a=s[4].a;let c=new C(0,0,0);c.x=s[4].r-o.r,c.y=s[4].g-o.g,c.z=s[4].b-o.b;let x=(w=F.find(a=>a.position.x==c.x&&a.position.y==c.y&&a.position.z==c.z))==null?void 0:w.value;x!="."&&(y+=x),x=="."&&(I=!0),I&&console.log(atob(y))}console.log("done! decode!"),e(atob(y))}})}setTimeout(()=>{document.getElementById("Render")},500);let p=document.getElementById("FileInputEncode"),E=document.getElementById("FileInputDecode"),j=document.getElementById("EncodeButton"),q=document.getElementById("DecodeButton"),R=document.getElementById("PreviewImage");var L="",S="";p.addEventListener("change",()=>{if(p==null||p.files==null)return;let n=p.files[0],e=new FileReader;e.onload=r=>{R.src=e.result,L=e.result},e.readAsDataURL(n)});let M=document.getElementById("EncodeText");j.addEventListener("click",()=>{T(L,M==null?void 0:M.value).then(n=>{R.src=n,alert(`Done!
Image on the left is now encoded with your text!
Right click to save it`)})});E.addEventListener("change",()=>{if(E==null||E.files==null)return;let n=E.files[0],e=new FileReader;e.onload=r=>{R.src=e.result,S=e.result},e.readAsDataURL(n)});q.addEventListener("click",()=>{A(S).then(n=>{let e=document.getElementById("DecodedText");e.value=n})});
